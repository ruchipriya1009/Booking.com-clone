import * as React from 'react';
import { useEffect, useState } from 'react';
import { DateTimePicker } from '@mui/x-date-pickers/DateTimePicker';
import dayjs from 'dayjs';
import Stack from '@mui/material/Stack';
import TextField from '@mui/material/TextField';
import { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';
import { AdapterDayjs } from '@mui/x-date-pickers/AdapterDayjs';
import { Link } from "react-router-dom";
import style from "./Style.module.css";
import IconButton from '@mui/material/IconButton';
import DirectionsCarOutlinedIcon from '@mui/icons-material/DirectionsCarOutlined';
import Radio from '@mui/material/Radio';
import RadioGroup from '@mui/material/RadioGroup';
import FormControlLabel from '@mui/material/FormControlLabel';
import FormControl from '@mui/material/FormControl';
import FormGroup from '@mui/material/FormGroup';
import Checkbox from '@mui/material/Checkbox';
import CityCard from './CityCard';
import LanguageIcon from '@mui/icons-material/Language';
import PublicIcon from '@mui/icons-material/Public';
import CloudIcon from '@mui/icons-material/Cloud';
import StarIcon from '@mui/icons-material/Star';
import Dropdown from 'react-bootstrap/Dropdown';
import DropdownButton from 'react-bootstrap/DropdownButton';
import ReportGmailerrorredIcon from '@mui/icons-material/ReportGmailerrorred';
import SearchBar from './SearchBar';
import countries from "./Countries";
import { SearchBar2 } from './SearchBar';
import { useDispatch } from "react-redux";
import { getCarSuccess } from '../../actions/caraction';

export default function CarRentals() {
    const [value, setValue] = React.useState(dayjs('2014-08-18T21:11:54'));
    const [startDate, setStartDate] = useState(new Date());
    const [returnDate, setReturnDate] = useState(new Date());
    const [startLocation, setStartLocation] = useState("")
    const [returnLocation, setReturnLocation] = useState("")
    const [popularCity, setPopularCity] = useState([]);
    const [carRental, setCarRental] = useState([]);
    const [loading, setLoading] = useState(false);
    const [suggestions, setSuggestions] = useState([]);
    const [suggestions2, setSuggestions2] = useState([]);
    const [show,setShow]=useState("true");

    useEffect(() => {
        if (startLocation === "") {
            setSuggestions([]);
        } else {
            let out = countries
                .filter((item) =>
                    item.country.toLowerCase().indexOf(startLocation) !== -1 ? true : false
                )
                .map((item) => item.country);
            setSuggestions(out);
        }
        setLoading(false);
    }, [startLocation]);

    useEffect(() => {
        if (returnLocation === "") {
            setSuggestions2([]);
        } else {
            let out = countries
                .filter((item) =>
                    item.city.toLowerCase().indexOf(returnLocation) !== -1 ? true : false
                )
                .map((item) => item.city);
            setSuggestions2(out);
        }
        setLoading(false);
    }, [returnLocation]);

    // console.log(startLocation,returnLocation,startDate,returnDate)
    const dispatch = useDispatch();
    const handleClickSearch = () => {
        dispatch(getCarSuccess({ startLocation, returnLocation, startDate, returnDate }))
    }

    const getData = () => {
        return fetch(`http://localhost:3005/popular_city_car_hire`)
    }

    useEffect(() => {
        getData()
            .then(res => res.json())
            .then((res) => {
                setPopularCity(res);
            })
            .catch((err) => {
                console.log(err)
            })
        getCarRental()
    }, [])

    const getCarRental = () => {
        return fetch(`http://localhost:3005/top_worldwide_car_rental`)
            .then((res) => res.json())
            .then((res) => {
                setCarRental(res);
            })
            .catch((err) => {
                console.log(err)
            })
    }

   

  const handleChange = (newValue) => {
    setValue(newValue);
  };
    return (
        <>
            <div className={style.covid}>
                <h4><ReportGmailerrorredIcon /> Clean cars. Flexible bookings. Socially distant rental counters.</h4>
                <p>Weâ€™re working with our partners to keep you safe and in the driving seat.</p>
                <div>
                    <Link className={style.covidLink}>Find out how</Link>
                </div>
            </div>
            <div className={style.carRentals}>
                <div className={style.box1}>
                    <div className={style.text}>
                        <h1>Car hire for any kind of trip</h1>
                        <p>Compare deals from the biggest car hire companies</p>
                    </div>
                    <div className={style.check}>
                        <FormControl component="fieldset">
                            <RadioGroup row defaultValue="true" name="row-radio-buttons-group" onChange={handleChange} >
                                <FormControlLabel value="true" control={<Radio />} label="Return to same location" />
                            <FormControlLabel value="false" control={<Radio />} label="Return to different location" />
                            </RadioGroup>
                        </FormControl>
                    </div>
                    <div className={style.box2}>
                        <div className={style.searchInputBox}>
                            <div className={style.pick}>
                                <IconButton sx={{ p: '10px' }} aria-label="menu">
                                    <DirectionsCarOutlinedIcon />
                                </IconButton>
                                <SearchBar
                                    loading={loading}
                                    setLoading={setLoading}
                                    value={startLocation}
                                    onChange={(val) => setStartLocation(val)}
                                    suggestions={suggestions}
                                    placeholder="Pick-up location"
                                />
                            </div>
                           { show==="true" ? null:  
                           <div className={style.drop}>
                                <IconButton sx={{ p: '10px' }} aria-label="menu">
                                    <DirectionsCarOutlinedIcon />
                                </IconButton>
                                <SearchBar2
                                    loading={loading}
                                    setLoading={setLoading}
                                    value={returnLocation}
                                    onChange={(val) => setReturnLocation(val)}
                                    suggestions={suggestions2}
                                    placeholder="Drop-off location"
                                />
                            </div>
                          }
                        </div>
                        <div className={style.searchDateBox}>

                        <LocalizationProvider dateAdapter={AdapterDayjs}>
                            <Stack spacing={3}>
                         <DateTimePicker
                              label=""
                              value={value}
                              onChange={handleChange}
                              renderInput={(params) => <TextField {...params} />}
                             />
                           </Stack>
                        </LocalizationProvider>

                        </div>

                        <div className={style.searchDateBox}>

                     <LocalizationProvider dateAdapter={AdapterDayjs}>
                     <Stack spacing={3}>
                     <DateTimePicker
                        label=""
                     value={value}
                       onChange={handleChange}
                       renderInput={(params) => <TextField {...params} />}
                          />
                           </Stack>
                     </LocalizationProvider>

</div>

                        <button className={style.searchButton} onClick={handleClickSearch}>
                            <Link to="/car-available" className={style.searchLink}>SEARCH</Link>
                        </button>
                    </div>
                    <div className={style.driverBox}>
                        <FormGroup>
                            <div className={style.form}>
                                <FormControlLabel control={<Checkbox defaultChecked />} label="Driver aged between 30 - 65 " />
                                <ReportGmailerrorredIcon />
                            </div>
                        </FormGroup>
                        <div>
                            <label>Driver's age</label>
                            <input type="text" placeholder='Age' className={style.driver} />
                        </div>
                    </div>
                </div>
                <div className={style.box3}>
                    <h1>Popular Car hire brands</h1>
                    <div className={style.logo}>
                        <img src="https://cdn.rcstatic.com/images/supplier_logos/europcar_logo_lrg.gif" alt="" />
                        <img src="https://cdn.rcstatic.com/images/supplier_logos/alamo_logo_lrg.gif" alt="" />
                        <img src="https://cdn.rcstatic.com/images/suppliers/flat/sixt_logo_lrg.gif" alt="" />
                        <img src="https://cdn.rcstatic.com/images/supplier_logos/avis_logo_lrg.gif" alt="" />
                        <img src="https://cdn.rcstatic.com/images/supplier_logos/enterprise_logo_lrg.gif" alt="" />
                        <img src="https://cdn.rcstatic.com/images/supplier_logos/dollar_logo_lrg.gif" alt="" />
                        <img src="https://cdn.rcstatic.com/images/supplier_logos/thrifty_logo_lrg.gif" alt="" />
                        <img src="https://cdn.rcstatic.com/images/suppliers/flat/sicily_by_car_logo_lrg.gif" alt="" />
                    </div>
                </div>
                <div className={style.box3}>
                    <h1>Popular destinations for car hire</h1>
                    <div className={style.box4}>
                        {
                            popularCity?.map((item) => {
                                return <CityCard
                                    key={item.id}
                                    id={item.id}
                                    city={item.city}
                                    carDetail={item.carDetail}
                                    fair={item.fair}
                                    image={item.image}
                                />
                            })
                        }
                    </div>
                </div>
                <div className={style.box5}>
                    <div>
                        <h1>World's biggest online car hire service</h1>
                        <p>Why you can find the right car in the right place with us...</p>
                    </div>
                    <div className={style.iconBox}>
                        <div className={style.icon}>
                            <LanguageIcon className={style.iconLogo} sx={{ fontSize: 60 }} />
                            <div className={style.text1}>
                                <h4>60,000+</h4>
                                <p>locations</p>
                            </div>
                        </div>
                        <div className={style.icon}>
                            <PublicIcon className={style.iconLogo} sx={{ fontSize: 60 }} />
                            <div className={style.text1}>
                                <h4>160</h4>
                                <p>countries</p>
                            </div>
                        </div>
                        <div className={style.icon}>
                            <CloudIcon className={style.iconLogo} sx={{ fontSize: 60 }} />
                            <div className={style.text1}>
                                <h4>43</h4>
                                <p>languages spoken</p>
                            </div>
                        </div>
                        <div className={style.icon}>
                            <StarIcon className={style.iconLogo} sx={{ fontSize: 60 }} />
                            <div className={style.text1}>
                                <h4>3500,000</h4>
                                <p>customer reviews</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div className={style.box6}>
                    <div className={style.box7}>
                        <h1>Frequently asked questions</h1>
                    </div>
                    <div className={style.box8}>
                        <DropdownButton id="dropdown-item-button" variant="outlined" size="lg" title="What do I need to rent a car?" className={style.size} >
                            <Dropdown.ItemText>When youâ€™re booking the car, you just need a debit or credit card.
                                At the rental counter, youâ€™ll need:
                                Your passport
                                Your voucher
                                Each driverâ€™s driving licence
                                The main driverâ€™s credit card (some rental companies also accept debit cards, but most donâ€™t).
                                Important: Please make sure you check the carâ€™s rental terms as well, as each rental company has its own rules. For example? They might need to see some extra ID. They might not accept certain types of credit card. Or they might not rent to any driver who hasnâ€™t held their driving licence for 36 months or more.</Dropdown.ItemText>
                        </DropdownButton>
                        <DropdownButton id="dropdown-item-button" variant="outlined" size="lg" title="Am I old enough to rent a car" className={style.size}>
                            <Dropdown.ItemText>Most companies will rent you a car if youâ€™re at least 21 (and some will rent to younger drivers). But if youâ€™re under 25, you might still have to pay a â€˜young driver feeâ€™.</Dropdown.ItemText>
                        </DropdownButton>
                        <DropdownButton id="dropdown-item-button" variant="outlined" size="lg" title="Can I book a car for my partner, friend, colleague, etc?" className={style.size}>
                            <Dropdown.ItemText>Of course. Just put their details in the â€˜Driver Detailsâ€™ form when youâ€™re booking the car.</Dropdown.ItemText>
                        </DropdownButton>
                        <DropdownButton id="dropdown-item-button" variant="outlined" size="lg" title="Any tips on choosing the right car?" className={style.size}>
                            <Dropdown.ItemText>Think about where youâ€™re going. An SUV might be great for cruising down a Texas freeway, but a smaller carâ€™s probably much easier to drive in Rome.
                                See what other people think. Youâ€™ll find lots of reviews and ratings on our site, so find out what other customers liked (and didnâ€™t like) about each rental company.
                                Donâ€™t forget the gearbox. In some countries, nearly everyone drives a manual car. In others, automatics are the norm. Make sure you rent one you can drive!</Dropdown.ItemText>
                        </DropdownButton>
                        <DropdownButton id="dropdown-item-button" variant="outlined" size="lg" title="is the rental price all inclusive?" className={style.size}>
                            <Dropdown.ItemText>The price you see includes the car, mandatory cover (e.g. Theft Protection and Collision Damage Waiver) and fees that, if they apply, are usually payable at pick-up (e.g. any one-way fees, airport surcharges or local taxes).

                                It also includes any extras youâ€™ve already added (e.g. GPS or baby seats).

                                It doesnâ€™t include any extra cover you buy when you get to the rental counter.

                                Tip: Thereâ€™s a full price breakdown on the Payment page.</Dropdown.ItemText>
                        </DropdownButton>
                       

                    </div>
                </div>
                <div className={style.box3}>
                    <div>
                        <h1>Top worldwide locations for car rental</h1>
                    </div>
                    <div className={style.box4}>
                        {
                            carRental?.map((item) => {
                                return <div key={item.id} className={style.card1}>
                                    <Link to={`/${item.city}`} className={style.link}>
                                        <img src={item.image} alt="" className={style.img} />
                                        <div className={style.text2}>
                                            <h3>{item.city}</h3>
                                            <p>Car hire from â‚¹ {item.fair} per day</p>
                                        </div>
                                    </Link>
                                </div>
                            })
                        }
                    </div>
                </div>
            </div>
        </>
    )
}